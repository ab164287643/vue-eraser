!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("vue-eraser",[],e):"object"==typeof exports?exports["vue-eraser"]=e():t["vue-eraser"]=e()}("undefined"!=typeof self?self:this,function(){return function(t){function e(s){if(n[s])return n[s].exports;var o=n[s]={i:s,l:!1,exports:{}};return t[s].call(o.exports,o,o.exports,e),o.l=!0,o.exports}var n={};return e.m=t,e.c=n,e.d=function(t,n,s){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:s})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="/dist/",e(e.s=1)}([function(t,e,n){"use strict";e.a={name:"vue-eraser",props:{elementId:{type:String,default:"vueEraser"},size:{type:Number,default:50},completeRatio:{type:Number,default:.7},completeFunction:{type:Function,default:function(){}},progressFunction:{type:Function,default:function(){}},resultSrc:{type:String,default:"http://cdn.dowebok.com/140/images/1.jpg"},coverSrc:{type:String,required:!0}},data:function(){return{source:null,width:0,height:0,canvas:null,canvasPosX:0,canvasPosY:0,canvasTouchX:0,canvasTouchY:0,isTouchDown:!1,mobileTouchID:null,ctx:null,parts:[],colParts:0,numParts:0,ratio:0,complete:!1}},created:function(){},mounted:function(){this.init()},methods:{init:function(){var t=this,e=this.$refs.eraserImg,n=document.querySelector("#"+t.elementId),s=void 0;t.source=e,setTimeout(function(){var o=new Image;o.src=t.coverSrc,o.onload=function(){t.width=e.offsetWidth,t.height=e.offsetHeight,t.canvas=document.createElement("canvas"),t.canvas.classList.add("eraser-canvas"),t.canvas.style.position="absolute",t.canvas.style.left="0",t.canvas.style.top="0",n.appendChild(t.canvas),t.canvas.width=t.width,t.canvas.height=t.height,t.ctx=t.canvas.getContext("2d"),s=t.canvas.getBoundingClientRect(),t.canvasPosX=s.left,t.canvasPosY=s.top,t.ctx.drawImage(e,0,0,t.width,t.height),setTimeout(function(){e.parentNode.removeChild(e),t.colParts=Math.floor(t.width/t.size),t.numParts=Math.floor(t.height/t.size)*t.colParts;for(var n=t.numParts;n--;)t.parts.push(1);t.ctx.globalCompositeOperation="destination-out",t.ctx.strokeStyle="rgba(255,0,0,255)",t.ctx.lineWidth=t.size,t.ctx.lineCap="round",t.bindEvent()})}},100),window.onresize=function(){s=t.canvas.getBoundingClientRect(),t.canvasPosX=s.left,t.canvasPosY=s.top}},bindEvent:function(){this.canvas.addEventListener("mousedown",this.mouseDown.bind(this),!1),this.canvas.addEventListener("touchstart",this.touchStart.bind(this),!1),this.canvas.addEventListener("touchmove",this.touchMove.bind(this),!1),this.canvas.addEventListener("touchend",this.touchEnd.bind(this),!1)},mouseDown:function(t){this.canvasTouchX=t.pageX-this.canvasPosX,this.canvasTouchY=t.pageY-this.canvasPosY,this.evaluatePoint(this.canvasTouchX,this.canvasTouchY),this.isTouchDown=!0,this.ctx.beginPath(),this.ctx.moveTo(this.canvasTouchX-1,this.canvasTouchY),this.ctx.lineTo(this.canvasTouchX,this.canvasTouchY),this.ctx.stroke(),this.mouseMove=this.mouseMove.bind(this),this.mouseUp=this.mouseUp.bind(this),this.canvas.addEventListener("mousemove",this.mouseMove,!1),document.addEventListener("mouseup",this.mouseUp,!1),t.preventDefault()},mouseMove:function(){var t=event.pageX-this.canvasPosX,e=event.pageY-this.canvasPosY;this.evaluatePoint(t,e),this.ctx.beginPath(),this.ctx.moveTo(this.canvasTouchX,this.canvasTouchY),this.ctx.lineTo(t,e),this.ctx.stroke(),this.canvasTouchX=t,this.canvasTouchY=e,event.preventDefault()},mouseUp:function(){this.isTouchDown=!1,this.canvas.removeEventListener("mousemove",this.mouseMove,!1),document.removeEventListener("mouseup",this.mouseUp,!1)},touchStart:function(t){if(!this.isTouchDown){var e=t.changedTouches[0];this.isTouchDown=!0,this.mobileTouchID=e.identifier,this.canvasTouchX=e.pageX-this.canvasPosX,this.canvasTouchY=e.pageY-this.canvasPosY,this.evaluatePoint(this.canvasTouchX,this.canvasTouchY)}t.preventDefault()},touchMove:function(t){if(this.isTouchDown)for(var e=t.changedTouches,n=e.length;n--;)if(e[n].identifier==this.mobileTouchID){var s=e[n].pageX-this.canvasPosX,o=e[n].pageY-this.canvasPosY;this.evaluatePoint(s,o),this.ctx.beginPath(),this.ctx.moveTo(this.canvasTouchX,this.canvasTouchY),this.canvasTouchX=s,this.canvasTouchY=o,this.ctx.lineTo(s,o),this.ctx.stroke();break}t.preventDefault()},touchEnd:function(t){if(this.isTouchDown)for(var e=t.changedTouches,n=e.length;n--;)if(e[n].identifier==this.mobileTouchID){this.isTouchDown=!1,t.preventDefault();break}},evaluatePoint:function(t,e){var n=Math.floor(t/this.size)+Math.floor(e/this.size)*this.colParts;n>=0&&n<this.numParts&&(this.ratio+=this.parts[n],this.parts[n]=0,this.complete||(this.ratio/this.numParts>=this.completeRatio?(this.complete=!0,null!=this.completeFunction&&"function"==typeof this.completeFunction&&this.completeFunction(this.ratio/this.numParts)):null!=this.progressFunction&&"function"==typeof this.progressFunction&&this.progressFunction(this.ratio/this.numParts)))},clear:function(){this.ctx.clearRect(0,0,this.width,this.height);for(var t=this.numParts;t--;)this.parts[t]=0;this.ratio=this.numParts,this.complete=!0,null!=this.completeFunction&&this.completeFunction()},reset:function(){this.ctx.globalCompositeOperation="source-over",this.ctx.drawImage(this.source,0,0),this.ctx.globalCompositeOperation="destination-out";for(var t=this.numParts;t--;)this.parts[t]=1;this.ratio=0,this.complete=!1}}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),n.d(e,"install",function(){return o});var s=n(2),o=function(t){arguments.length>1&&void 0!==arguments[1]&&arguments[1];t.component(s.a.name,s.a)};"undefined"!=typeof window&&window.Vue&&o(window.Vue),e.default=s.a},function(t,e,n){"use strict";var s=n(3);s.a.install=function(t){return t.component(s.a.name,s.a)},"undefined"!=typeof window&&window.Vue&&window.Vue.use(s.a),e.a=s.a},function(t,e,n){"use strict";function s(t){n(4)}var o=n(0),i=n(10),a=n(9),r=s,c=a(o.a,i.a,!1,r,null,null);e.a=c.exports},function(t,e,n){var s=n(5);"string"==typeof s&&(s=[[t.i,s,""]]),s.locals&&(t.exports=s.locals);n(7)("38cd052e",s,!0,{})},function(t,e,n){e=t.exports=n(6)(!1),e.push([t.i,".vue-eraser{position:relative;width:100%;user-select:none}.vue-eraser .img-wraper,.vue-eraser .img-wraper img{width:100%}.vue-eraser .cover-img{z-index:2;background-color:#fff}.vue-eraser .cover-img,.vue-eraser .eraser-canvas{position:absolute;left:0;top:0;width:100%;height:100%}.vue-eraser .eraser-canvas{z-index:3}",""])},function(t,e){function n(t,e){var n=t[1]||"",o=t[3];if(!o)return n;if(e&&"function"==typeof btoa){var i=s(o);return[n].concat(o.sources.map(function(t){return"/*# sourceURL="+o.sourceRoot+t+" */"})).concat([i]).join("\n")}return[n].join("\n")}function s(t){return"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(t))))+" */"}t.exports=function(t){var e=[];return e.toString=function(){return this.map(function(e){var s=n(e,t);return e[2]?"@media "+e[2]+"{"+s+"}":s}).join("")},e.i=function(t,n){"string"==typeof t&&(t=[[null,t,""]]);for(var s={},o=0;o<this.length;o++){var i=this[o][0];"number"==typeof i&&(s[i]=!0)}for(o=0;o<t.length;o++){var a=t[o];"number"==typeof a[0]&&s[a[0]]||(n&&!a[2]?a[2]=n:n&&(a[2]="("+a[2]+") and ("+n+")"),e.push(a))}},e}},function(t,e,n){function s(t){for(var e=0;e<t.length;e++){var n=t[e],s=h[n.id];if(s){s.refs++;for(var o=0;o<s.parts.length;o++)s.parts[o](n.parts[o]);for(;o<n.parts.length;o++)s.parts.push(i(n.parts[o]));s.parts.length>n.parts.length&&(s.parts.length=n.parts.length)}else{for(var a=[],o=0;o<n.parts.length;o++)a.push(i(n.parts[o]));h[n.id]={id:n.id,refs:1,parts:a}}}}function o(){var t=document.createElement("style");return t.type="text/css",d.appendChild(t),t}function i(t){var e,n,s=document.querySelector("style["+g+'~="'+t.id+'"]');if(s){if(v)return p;s.parentNode.removeChild(s)}if(b){var i=f++;s=l||(l=o()),e=a.bind(null,s,i,!1),n=a.bind(null,s,i,!0)}else s=o(),e=r.bind(null,s),n=function(){s.parentNode.removeChild(s)};return e(t),function(s){if(s){if(s.css===t.css&&s.media===t.media&&s.sourceMap===t.sourceMap)return;e(t=s)}else n()}}function a(t,e,n,s){var o=n?"":s.css;if(t.styleSheet)t.styleSheet.cssText=T(e,o);else{var i=document.createTextNode(o),a=t.childNodes;a[e]&&t.removeChild(a[e]),a.length?t.insertBefore(i,a[e]):t.appendChild(i)}}function r(t,e){var n=e.css,s=e.media,o=e.sourceMap;if(s&&t.setAttribute("media",s),m.ssrId&&t.setAttribute(g,e.id),o&&(n+="\n/*# sourceURL="+o.sources[0]+" */",n+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(o))))+" */"),t.styleSheet)t.styleSheet.cssText=n;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(n))}}var c="undefined"!=typeof document;if("undefined"!=typeof DEBUG&&DEBUG&&!c)throw new Error("vue-style-loader cannot be used in a non-browser environment. Use { target: 'node' } in your Webpack config to indicate a server-rendering environment.");var u=n(8),h={},d=c&&(document.head||document.getElementsByTagName("head")[0]),l=null,f=0,v=!1,p=function(){},m=null,g="data-vue-ssr-id",b="undefined"!=typeof navigator&&/msie [6-9]\b/.test(navigator.userAgent.toLowerCase());t.exports=function(t,e,n,o){v=n,m=o||{};var i=u(t,e);return s(i),function(e){for(var n=[],o=0;o<i.length;o++){var a=i[o],r=h[a.id];r.refs--,n.push(r)}e?(i=u(t,e),s(i)):i=[];for(var o=0;o<n.length;o++){var r=n[o];if(0===r.refs){for(var c=0;c<r.parts.length;c++)r.parts[c]();delete h[r.id]}}}};var T=function(){var t=[];return function(e,n){return t[e]=n,t.filter(Boolean).join("\n")}}()},function(t,e){t.exports=function(t,e){for(var n=[],s={},o=0;o<e.length;o++){var i=e[o],a=i[0],r=i[1],c=i[2],u=i[3],h={id:t+":"+o,css:r,media:c,sourceMap:u};s[a]?s[a].parts.push(h):n.push(s[a]={id:a,parts:[h]})}return n}},function(t,e){t.exports=function(t,e,n,s,o,i){var a,r=t=t||{},c=typeof t.default;"object"!==c&&"function"!==c||(a=t,r=t.default);var u="function"==typeof r?r.options:r;e&&(u.render=e.render,u.staticRenderFns=e.staticRenderFns,u._compiled=!0),n&&(u.functional=!0),o&&(u._scopeId=o);var h;if(i?(h=function(t){t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,t||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),s&&s.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(i)},u._ssrRegister=h):s&&(h=s),h){var d=u.functional,l=d?u.render:u.beforeCreate;d?(u._injectStyles=h,u.render=function(t,e){return h.call(e),l(t,e)}):u.beforeCreate=l?[].concat(l,h):[h]}return{esModule:a,exports:r,options:u}}},function(t,e,n){"use strict";var s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"vue-eraser",attrs:{id:t.elementId}},[n("div",{staticClass:"img-wraper"},[n("img",{ref:"resultSrc",attrs:{src:t.resultSrc,alt:""}})]),t._v(" "),t.coverSrc?n("img",{ref:"eraserImg",staticClass:"cover-img",attrs:{src:t.coverSrc,alt:""}}):t._e()])},o=[],i={render:s,staticRenderFns:o};e.a=i}])});
//# sourceMappingURL=vue-eraser.js.map